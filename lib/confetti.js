import confetti from 'canvas-confetti'

let currentInterval = null

export const handleConfetti = () => {
    // Clear any existing interval and reset confetti canvas before starting a new one
    if (currentInterval !== null) {
        clearInterval(currentInterval)
        currentInterval = null
    }
    // Immediately clear all existing confetti particles
    confetti.reset()

    const duration = 5 * 1000
    const animationEnd = Date.now() + duration
    const defaults = {
        startVelocity: 30,
        spread: 360,
        ticks: 60,
        zIndex: 0,
        colors: ['#10B981', '#0EA5E9', '#D946EF', '#F59E0B'],
    }
    const ocron = confetti.shapeFromPath({
        path: 'M0 43.6027C0 39.4691 0.633385 35.7355 1.90013 32.402C3.16687 29.0018 4.96697 26.1349 7.30044 23.8014C9.63392 21.4013 12.4341 19.5679 15.701 18.3011C18.9678 16.9677 22.6347 16.301 26.7016 16.301C30.7685 16.301 34.4354 16.9677 37.7023 18.3011C41.0358 19.5679 43.8693 21.4013 46.2028 23.8014C48.5363 26.1349 50.3364 29.0018 51.6032 32.402C52.8699 35.7355 53.5033 39.4691 53.5033 43.6027C53.5033 47.7362 52.8699 51.4698 51.6032 54.8033C50.3364 58.1369 48.5363 61.0037 46.2028 63.4039C43.8693 65.7373 41.0358 67.5708 37.7023 68.9042C34.4354 70.1709 30.7685 70.8043 26.7016 70.8043C22.6347 70.8043 18.9678 70.1709 15.701 68.9042C12.4341 67.5708 9.63392 65.7373 7.30044 63.4039C4.96697 61.0037 3.16687 58.1369 1.90013 54.8033C0.633385 51.4698 0 47.7362 0 43.6027ZM14.2009 43.6027C14.2009 45.6694 14.4009 47.7029 14.8009 49.703C15.2009 51.6365 15.8676 53.4032 16.801 55.0033C17.8011 56.5368 19.1012 57.7702 20.7013 58.7036C22.3014 59.637 24.3015 60.1037 26.7016 60.1037C29.1018 60.1037 31.1019 59.637 32.702 58.7036C34.3688 57.7702 35.6689 56.5368 36.6022 55.0033C37.6023 53.4032 38.3023 51.6365 38.7024 49.703C39.1024 47.7029 39.3024 45.6694 39.3024 43.6027C39.3024 41.5359 39.1024 39.5024 38.7024 37.5023C38.3023 35.5022 37.6023 33.7354 36.6022 32.202C35.6689 30.6685 34.3688 29.4351 32.702 28.5017C31.1019 27.5017 29.1018 27.0016 26.7016 27.0016C24.3015 27.0016 22.3014 27.5017 20.7013 28.5017C19.1012 29.4351 17.8011 30.6685 16.801 32.202C15.8676 33.7354 15.2009 35.5022 14.8009 37.5023C14.4009 39.5024 14.2009 41.5359 14.2009 43.6027ZM9.20057 0H44.5027V7.50045H9.20057V0Z',
    })
    // const hello = confetti.shapeFromPath({
    //     path: "M206.717 18.3047C210.784 18.3047 214.451 18.9713 217.718 20.3047C221.051 21.5714 223.885 23.4055 226.219 25.8057C228.552 28.1391 230.352 31.0062 231.619 34.4062C232.886 37.7396 233.519 41.4731 233.519 45.6064C233.519 49.74 232.886 53.4741 231.619 56.8076C230.352 60.1411 228.552 63.0081 226.219 65.4082C223.885 67.7416 221.051 69.5748 217.718 70.9082C214.451 72.1749 210.784 72.8086 206.717 72.8086C202.65 72.8085 198.983 72.1748 195.717 70.9082C192.45 69.5749 189.65 67.7415 187.316 65.4082C184.983 63.0082 183.183 60.141 181.916 56.8076C180.649 53.4741 180.016 49.74 180.016 45.6064C180.016 41.473 180.649 37.7397 181.916 34.4062C183.183 31.006 184.983 28.1391 187.316 25.8057C189.65 23.4055 192.45 21.5714 195.717 20.3047C198.983 18.9714 202.65 18.3047 206.717 18.3047ZM96.5283 18.3047C100.929 18.3047 104.762 19.1718 108.029 20.9053C111.296 22.572 113.963 24.8385 116.029 27.7051C118.163 30.5719 119.696 33.839 120.63 37.5059C121.563 41.1727 121.897 45.0066 121.63 49.0068H84.3281C84.5282 53.6069 85.6948 56.9401 87.8281 59.0068C89.9615 61.0736 93.0282 62.1074 97.0283 62.1074C99.8951 62.1074 102.362 61.4069 104.429 60.0068C106.495 58.5401 107.763 57.0073 108.229 55.4072H120.73C118.73 61.6075 115.663 66.0412 111.529 68.708C107.396 71.3747 102.395 72.708 96.5283 72.708C92.4616 72.708 88.7951 72.0743 85.5283 70.8076C82.2616 69.4743 79.4943 67.608 77.2275 65.208C74.9608 62.8079 73.1935 59.9409 71.9268 56.6074C70.7267 53.2739 70.127 49.6067 70.127 45.6064C70.127 41.7395 70.7606 38.1392 72.0273 34.8057C73.2941 31.4722 75.0943 28.6052 77.4277 26.2051C79.7611 23.7385 82.5276 21.8053 85.7275 20.4053C88.9943 19.0052 92.5948 18.3047 96.5283 18.3047ZM15.7012 27.4014H44.6025V0H60.3037V71.4043H44.6025V40.6025H15.7012V71.4043H0V0H15.7012V27.4014ZM144.652 71.4043H130.451V0H144.652V71.4043ZM170.436 71.4043H156.234V0H170.436V71.4043ZM206.717 29.0059C204.317 29.0059 202.317 29.5059 200.717 30.5059C199.117 31.4392 197.816 32.6727 196.816 34.2061C195.883 35.7393 195.216 37.506 194.816 39.5059C194.416 41.5059 194.217 43.5397 194.217 45.6064C194.217 47.6732 194.416 49.7069 194.816 51.707C195.216 53.6403 195.883 55.4069 196.816 57.0068C197.816 58.5402 199.117 59.7737 200.717 60.707C202.317 61.6404 204.317 62.1074 206.717 62.1074C209.117 62.1074 211.118 61.6404 212.718 60.707C214.384 59.7737 215.685 58.5402 216.618 57.0068C217.618 55.4069 218.318 53.6403 218.718 51.707C219.118 49.7069 219.318 47.6732 219.318 45.6064C219.318 43.5397 219.118 41.5059 218.718 39.5059C218.318 37.506 217.618 35.7393 216.618 34.2061C215.685 32.6727 214.384 31.4392 212.718 30.5059C211.118 29.5058 209.117 29.0059 206.717 29.0059ZM96.1289 29.0049C93.8621 29.0049 91.9612 29.405 90.4277 30.2051C88.9611 30.9384 87.7615 31.8725 86.8281 33.0059C85.9615 34.1392 85.3278 35.3389 84.9277 36.6055C84.5944 37.8721 84.3948 39.0058 84.3281 40.0059H107.43C106.763 36.4058 105.562 33.6724 103.829 31.8057C102.162 29.939 99.5956 29.0049 96.1289 29.0049ZM224.519 9.50391H189.216V2.00391H224.519V9.50391Z"
    // })
    const randomInRange = (min, max) => Math.random() * (max - min) + min
    currentInterval = window.setInterval(() => {
        const timeLeft = animationEnd - Date.now()
        if (timeLeft <= 0) {
            clearInterval(currentInterval)
            currentInterval = null
            return
        }
        const progress = 1 - timeLeft / duration
        // Scale increases from 1 to 2.5 as animation progresses
        const scalar = 2.5 + progress * 1.5
        const particleCount = 50 * (timeLeft / duration)
        confetti({
            ...defaults,
            scalar,
            particleCount,
            shapes: [ocron],
            origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },
        })
        confetti({
            ...defaults,
            scalar,
            particleCount,
            shapes: [ocron],
            origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },
        })
    }, 250)
}
